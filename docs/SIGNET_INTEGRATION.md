# Bitcoin Signet Integration Guide

## Overview

Covenant anchors player reputation to Bitcoin Signet via real zero-knowledge proofs generated by the Charms zkVM.

## How It Works

1. **Game completes** - Player reputation calculated from move history
2. **Proof generated** - `charms spell prove` CLI runs zkVM (takes ~5 min)
3. **2-tx pattern created** - Returns `[commit_tx_hex, spell_tx_hex]`
4. **Wallet signs** - Both transactions signed via wallet (Unisat/Leather)
5. **Broadcast** - `bitcoin submitpackage` sends pair atomically
6. **On-chain** - Reputation proof anchored in Bitcoin witness data

## Setup

### 1. Install Charms CLI
```bash
cargo install charms --version=0.10.0
```

### 2. Build Rust App
```bash
cd charm-apps/trust-game
cargo build --release
# Output: target/release/trust-game
```

### 3. Initialize in Code
```javascript
const { initCharmsCLIProver } = require('./js/bitcoin/CharmsCLIProver.js');
const prover = initCharmsCLIProver({
  charmsAppBin: '/path/to/target/release/trust-game'
});
```

### 4. Submit Move with Proof
```javascript
const result = await charmsClient.submitMove(
  {
    player_address: 'tb1q...',
    moves: [0, 0, 1, 0],
    opponent_moves: [0, 1, 1, 0],
    payoffs: [2, 3, -1, 0]
  },
  { txid: '...', vout: 1, amount: 50000 },
  'tb1q...'  // change address
);

// result: { commitTxHex, spellTxHex, commitTxid, spellTxid }
```

## Files

| File | Purpose |
|------|---------|
| `js/bitcoin/CharmsCLIProver.js` | Real proof generation via `charms spell prove` |
| `js/bitcoin/CharmsClient.js` | Game move & reputation submission |
| `charm-apps/trust-game/src/main.rs` | zkVM entry point |
| `charm-apps/trust-game/spell.yaml` | Spell definition (2-tx pattern) |

## Transaction Format

Both commit and spell transactions follow official Charms spec:

**Commit TX**: Creates output with commitment hash (OP_RETURN)
**Spell TX**: Spends commit, embeds proof in witness data

Witness structure: `["", proof_hex, spell_data_hex, ""]`

## Next Steps

- [ ] Create backend service wrapping `charms spell prove`
- [ ] UI integration for wallet signing
- [ ] Support Unisat/Leather wallet integration
- [ ] Test with real Signet UTXO
